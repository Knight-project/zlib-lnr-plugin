var t=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function c(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}l((i=i.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,i,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(r=0)),r;)try{if(n=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){r=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(6===c[0]&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(t){c=[6,t],i=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),i=require("@libs/novelStatus"),o=function(){function o(){var t=this;this.id="zlibrary",this.name="Z-Library",this.icon="src/en/zlib/zlib-1.png",this.site="https://z-lib.fm",this.version="1.0.2",this.filters=void 0,this.imageRequestInit=void 0,this.resolveUrl=function(e,n){return t.site+"/book/"+e}}return o.prototype.popularNovels=function(i,o){return t(this,arguments,void 0,(function(t,i){var o,r,a;i.showLatestNovels,i.filters;return e(this,(function(t){switch(t.label){case 0:return o=[],[4,this.getHtml(this.site+"/popular")];case 1:return r=t.sent(),(a=(0,n.load)(r))("div.masonry-endless").find("div.item").each((function(t,e){var n=a(e),i=n.find("z-cover").attr("title"),r="".concat(n.find("a").attr("href")),c=n.find("z-cover").find("img").attr("src"),l="".concat(i),s="".concat(r.replace(/^\/book\//,""));o.push({name:l,path:s,cover:c})})),[2,o]}}))}))},o.prototype.getHtml=function(n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch(n)];case 1:return[4,t.sent().text()];case 2:return[2,t.sent()]}}))}))},o.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,r,a,c,l,s,d,v,u,p,b,f,h,m,y,x;return e(this,(function(e){switch(e.label){case 0:return[4,this.getHtml("".concat(this.site,"/book/").concat(o))];case 1:return t=e.sent(),r=(0,n.load)(t),(a={path:o,name:r("div.col-sm-9").find("h1").text().trim()}).name="".concat(r("div.col-sm-9").find("h1").text().trim()),a.author="".concat(r("z-cover").attr("author")),a.cover="".concat(r("z-cover").find("img").attr("src")),a.genres="".concat(r("div.col-sm-9").find("div.bookDetailsBox").find("div.property_value").find("a").text().trim()),a.status=i.NovelStatus.Completed,a.rating=r("div.col-sm-9 div.book-rating-detail div.book-rating span.book-rating-interest-score").text().trim(),c=r("div.col-sm-9").find("#bookDescriptionBox").text().trim(),l=c.split(/\n+/).map((function(t){return t.trim()})).filter(Boolean).join("\n\n"),s=l||"Description Unavailable",d=r("div.col-sm-9 div.bookDetailsBox div.property_content_type").find("span").text().trim()||"Unavailable",v=r("div.col-sm-9 div.bookDetailsBox div.property_year").find("div.property_value").text().trim()||"Unavailable",u=r("div.col-sm-9 div.bookDetailsBox div.property_publisher").find("div.property_value").text().trim()||"Unavailable",p=r("div.col-sm-9 div.bookDetailsBox div.property_language").find("div.property_value").text().toUpperCase().trim()||"Unavailable",b=r("div.col-sm-9 div.bookDetailsBox div.property_pages").find("div.property_value").text().trim()||"Unavailable",f=r("div.col-sm-9 div.bookDetailsBox div.10").find("div.property_value").text().trim()||"Unavailable",h=r("div.col-sm-9 div.bookDetailsBox div.13").find("div.property_value").text().trim()||"Unavailable",m=r("div.col-sm-9 div.bookDetailsBox div.property__file").find("div.property_value").text().trim()||"Unavailable",a.summary="Name : ".concat(r("div.col-sm-9").find("h1").text().trim(),"\nType : ").concat(d,"\nYear : ").concat(v,"\nPublisher : ").concat(u,"\nLanguage : ").concat(p,"\nPages : ").concat(b,"\nISBN10 : ").concat(f,"\nISBN13 : ").concat(h,"\nFiletype&Size : ").concat(m,"\n\n").concat(s),y=[],x={name:"Download/read ".concat(r("div.col-sm-9").find("h1").text().trim()),path:"".concat(o),releaseTime:r("div.col-sm-9 div.bookDetailsBox div.property_year").find("div.property_value").text().trim()||"Unavailable",chapterNumber:0},y.push(x),a.chapters=y,[2,a]}}))}))},o.prototype.parseChapter=function(i){return t(this,void 0,void 0,(function(){var t,o,r,a;return e(this,(function(e){switch(e.label){case 0:return[4,this.getHtml("".concat(this.site,"/book/").concat(i))];case 1:return t=e.sent(),o=(0,n.load)(t),r=o("div.col-md-12 div section.book-actions-container div.book-details-button div.btn-group").eq(0).find("a.btn").attr("href"),i?(a="".concat(this.site,"/book/").concat(i),[2,'\n          <p>\n            <br/>\n            <br/>\n            <b>Plese login to the Z-Library website to download/read the book.</b>\n            <br/>\n            <br/>\n            <b>Remember to import the downloaded EPUB file to access it in the lnreader app.</b>\n            <br/>\n            <br/>\n            <br/>\n            <b>Click below to Read the book online</b><br/>\n            <a href="'.concat(r,'">Read Online</a>\n            <br/>\n            <br/>\n            <br/>\n            <b>Click below to download the EPUB :\n (!! To download without leaving lnreader open the webview in the novel page after clicking the link! !!)</b>\n            <br/>\n            <a href="').concat(a,'">Download</a>\n            <br/>\n            <br/>\n            <br/>\n            <b>Happy reading!</b>\n          </p>\n        ')]):[2,"No content."]}}))}))},o.prototype.searchNovels=function(i){return t(this,void 0,void 0,(function(){var t,o,r;return e(this,(function(e){switch(e.label){case 0:return t=[],[4,this.getHtml(this.site+"/s/"+i.trim())];case 1:return o=e.sent(),(r=(0,n.load)(o))("#searchResultBox").find("div.book-item").each((function(e,n){var i=r(n),o=i.find("div[slot=title]").text().trim(),a="".concat(i.find("z-bookcard").attr("href")),c=i.find("z-bookcard").find("img").attr("data-src"),l="".concat(o),s="".concat(a.replace(/^\/book\//,""));t.push({name:l,path:s,cover:c})})),[2,t]}}))}))},o}();exports.default=new o;